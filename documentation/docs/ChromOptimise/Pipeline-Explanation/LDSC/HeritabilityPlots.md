---
title: HeritabilityPlots
description: "The script used to create plots of partitioned heritability."
sidebar_position: 4
---

# HeritabilityPlots

## Explanation

This script will take in the `.results` files that are outputted from ldsc's 
partitioned heritability and visualise them for you. The two output files are:

1) A heatmap of the enrichment (Proportion of heritability for state / 
proportion of SNPS for state) for each state against each GWAS trait selected
2) A barplot for the p-values of the enrichment scores for each state for each 
GWAS trait selected 

This is the main output of runLDSC.sh that enables the user to interpret the 
biological relevance of their states. If lots of states are showing very 
little enrichment for any of the traits that you are considering, this 
suggests that the model is too specific still (or there is a problem with your 
input data).

## Interpretation

The colour palette of the heatmap is such that higher enrichment values ($>1$)
are redish and lower enrichment values ($<1$) are yellowish. So a deeper red
colour signifies high enrichment (annotation has high proportion of SNP
heritability explained divided by the proportion of SNPs it covers), a deeper
yellow colour signifies a lower enrichment (closer to 0). Any negative
enrichment or ridiculously high enrichment ($>100$) is given with a grey box.
The actual values for the enrichment heatmap are also given in the outputted
csv file (Enrichments.csv)

Enrichment is defined as:
> The proportion of SNP heritability explained divided by the proportion of
SNPs

In general you should ignore negative enrichment as
this usually stems from negative heritability (which is nonsensicle).For 
positive values however, the following interpretations can be made:

- An enrichment value greater than 1 (redish) implies that the regions defined
  by the annotation explain a high proportion of snp heritability considering
  they have a relatively small percentage of all snps.
- An enrichment value less than 1 (yellowish) implies the opposite. Regions
  defined by the annotaiton generally explain very little snp heritabilty
  considering the total percentage of SNPs they account for.
- An enrichment value close to 1 is what you would see for a category like
  base. Base is a category that every SNP falls into (to ensure all SNPs are
  accounted for). Base therefore explains 100% of SNP heritability and contains
  100% of all SNPs, resulting in an enrichment of 1. An enrichment of 1 is not
  a significant result of partitioned heritability.

### p-value thresholds

A baseline value of 0.05 was chosen for a p-value threshold. This was arbitrary
and the user is free to change this in the associated script 
(`HeritabilityPlots.R`). However, this p-value threshold is under jeopardy due
to the high number of hypotheses that are being tested at once. If you are
looking at ~10 different gwas traits in your analysis, you end up testing
hundreds of hypotheses at once (as you are looking at the enrichment for
every annotation as well). 

To account for this, two correction methods were implemented: Bonferroni
correction and FDR correction (using Benjamini and Hochberg method). The FDR
threshold is given by the grey dotted line on the bar plots and Bonferroni
threshold is given by the black dotted line. These correction methods help
mitigate the possibility of accepting a low pvalue that ocurred due to chance.

The heatmap gives you a quick overview of the p-values with stars. A single
star means that the enrichment is fdr significant, 2 stars means the enrichment
is Bonferroni significant. For more indepth information look at the bar charts 
for each gwas trait.

:::info[Number of hypotheses]
The number of hypotheses should be equal to the number of entries in the
complete (all categories) heatmap. However, the user is not actaully able to
control the number of annotations that come from the baseline files provided
by the team behind ldsc. As such, we decided to discount the hypotheses
generated by baseline annotations when calculating corrected p-value
thresholds. This makes the thresholds more reactive to the user's inputs and
data set.

Also note that these thresholds are to be taken with a mound of salt. Not only
is the original threshold arbitrary, but the corrected thresholds implicitly
assume that the hypotheses are independent of one another. In general, gwas
results are not independent of one another, so values are over corrected. Keep
this in consideration when rejecting the null hypothesis.
:::

## Warning message

Sometimes, this script will output the file WARNING.txt into the root of the
plots folder. This file will tell the user that their enrichment heatmap has
a high proportion of negative enrichments. Mathematically a negative enrichment
is nonsensicle (it is defined as the quotient of two scrictly positive values).
However, ldsc uses an unbiased estimator of $r^2$ due to the biases when
running over a large number of SNPS (which can be negative). The creators of
ldsc state that:

> If more than a few percent of all SNPs have negative LD Scores, this 
probably means that something is wrong, either that the sample size used for 
estimating LD Scores is too small or the window size used is too large. 

If this does happen to you, please look at the enrichment heatmap and check the
following:

- Is there a specific category that appears to be more often negatively 
enriched than not?
  - If so, then add the category to the list of blacklisted categories in
  `CreateAnnotationFile.R` (the vector can be found at the end of the file).
- Are the negative enrichment values somewhat evenly distributed throughout the
heatmap?
  - If so, then make the window size smaller in `7_ReferenceLDSCore.sh`. Change
  the flag `--ld-wind-cm 1` to have a smaller value than 1.
  - This line can be found in the reference LD scores section of the script

If problems continue to persist, there may be a problem with the dataset that
you are calculating LD scores for. Create an issue for this repository or
[ldsc](https://github.com/bulik/ldsc/issues) for further assistance.
