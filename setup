#!/bin/bash
# File is not using .sh extension to avoid changing its own contents during
# sed lines.

## =================================================================================##
##                                                                                  ||
##                                     PREAMBLE                                     ||
##                                                                                  ||
## =================================================================================##
## PURPOSE:                                                                         ||
## Creates directory structure given in the FilePaths.txt and allows the user to    ||
## remove any mention of 'module load' or 'module purge'.                           ||
## =================================================================================##
## AUTHOR: Sam Fletcher                                                             ||
## CONTACT: s.o.fletcher@exeter.ac.uk                                               ||
## CREATED: January 2024                                                            ||
## =================================================================================##
## DEPENDENCIES: sed                                                                ||
## =================================================================================##
## INPUTS:                                                                          ||
## $1 -> Full (or relative) file path for configuation file directory               ||
## =================================================================================##

# Configuration file is required for file paths

configuration_directory=$1

source "${configuration_directory}/FilePaths.txt" || \
{ echo "The configuration file does not exist in the specified location: \
${configuration_directory}"; exit 1; }

mkdir -p "${DOWNLOAD_DIR}"
mkdir -p "${RAW_DIR}"
mkdir -p "${PROCESSED_DIR}"
mkdir -p "${SUBSAMPLED_DIR}"
mkdir -p "${BINARY_DIR}"
mkdir -p "${MODEL_DIR}"
mkdir -p "${OPTIMUM_STATES_DIR}"
mkdir -p "${COMPARE_DIR}"
mkdir -p "${BIG_MODELS_DIR}"

cd "${SCRIPT_DIR}" || \
{ echo "The configuration file does not point to the correct script directory: \
${SCRIPT_DIR}"; exit 1; }

script_list=$(find . -type f -name "*.sh")

echo "Do you want to remove instances of \"module load\" and \"module purge\"? (y/n)"
read -r delete_module_lines

if [[ "${delete_module_lines}" == "y" ]]; then
    for file in $script_list; do
        sed -i "s/module load.*//g" "${file}"
        sed -i "s/module purge//g" "${file}"
    done
fi
